# 設計: Android バックグラウンド検証

## コンテキスト

Android はバックグラウンド実行を制限しています。ジオフェンシングには `expo-location` を、定期チェックには `react-native-background-fetch` を使用しています。これらがトリガーされると、フォアグラウンドサービス (`utils/androidBackground.ts`) を起動して BLE スキャンを実行します。

## 検証戦略

### 1. 通知による可観測性

バックグラウンドでは UI を確認できないため、**ローカル通知**に依存します。

- **ジオフェンス**: "Entered Area" / "Exited Area"
- **スキャン**: "Scanning for Beacons..." (フォアグラウンドサービス通知)
- **結果**: "Attendance Recorded" または "Scan Finished (No Device)"

### 2. ログによる可観測性

`adb logcat` で確認できる `console.log` を使用します。

- タグ: `[Geofencing Task]`, `[Periodic Check]`, `[Android Background]`

### 3. テスト計画

以下の理由から、手動テスト計画が必要です：

- エミュレータでのジオフェンスシミュレーションは可能ですが、実際のバックグラウンド制限（Doze モード、App Standby）を完全には反映しません。
- 接続テストには実際の BLE ハードウェアが必要です。

## トレードオフ

- **通知**: 通知が多すぎると煩わしくなる可能性があります。デバッグ通知は明確に区別するか、`__DEV__` または特定のデバッグモード設定でのみ有効にする必要があります。_決定: 既存の `DEBUG_BLE` 定数または `__DEV__` チェックを使用する。_

## 代替案

- **アプリ内ログビューア**: ログを表示する UI を構築する。_スコープを小さく保つため、今回は却下。_ 開発者には ADB で十分であり、高レベルの検証には通知で十分です。
